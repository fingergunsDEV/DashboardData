<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>BI Dashboard CRM</title>
  <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.development.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4/dist/chart.umd.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root {
      --primary: #1e40af;
      --secondary: #34d399;
    }
    .accessibility-widget { transition: all 0.3s ease; }
    .accessibility-widget button:focus { outline: 2px solid var(--primary); }
    [data-theme="dark"] {
      --bg-color: #1f2937;
      --text-color: #f3f4f6;
      --card-bg: #374151;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
    }
    [data-theme="light"] {
      --bg-color: #f3f4f6;
      --text-color: #1f2937;
      --card-bg: #ffffff;
      --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
  </style>
</head>
<body class="font-sans transition-colors duration-300" data-theme="light">
  <div id="root"></div>
  <script type="text/babel">
    const { useState, useEffect, useRef } = React;
    const { createRoot } = ReactDOM;

    const initialData = {
      Sales: [{ month: 'Jan', value: 12000 }, { month: 'Feb', value: 15000 }, { month: 'Mar', value: 18000 }],
      Marketing: [{ campaign: 'Email', leads: 200 }, { campaign: 'Social', leads: 350 }, { campaign: 'SEO', leads: 150 }],
      'Customer Service': [{ month: 'Jan', tickets: 50 }, { month: 'Feb', tickets: 40 }, { month: 'Mar', tickets: 60 }],
      Advertising: [{ platform: 'Google', spend: 5000 }, { platform: 'Meta', spend: 3000 }],
      Branding: [{ channel: 'Twitter', impressions: 10000 }, { channel: 'Instagram', impressions: 8000 }],
      OKR: [{ goal: 'Q1', progress: 75 }, { goal: 'Q2', progress: 50 }],
      Revenue: [{ month: 'Jan', amount: 20000 }, { month: 'Feb', amount: 25000 }, { month: 'Mar', amount: 30000 }],
    };

    const headerConfig = {
      Sales: ['month', 'value'],
      Marketing: ['campaign', 'leads'],
      'Customer Service': ['month', 'tickets'],
      Advertising: ['platform', 'spend'],
      Branding: ['channel', 'impressions'],
      OKR: ['goal', 'progress'],
      Revenue: ['month', 'amount'],
    };

    const Sidebar = ({ setActiveTab, theme, toggleTheme, activeTab, handleFileUpload }) => {
      const tabs = ['Sales', 'Marketing', 'Customer Service', 'Advertising', 'Branding', 'OKR', 'Revenue'];
      const [selectedCategory, setSelectedCategory] = useState('Sales');

      return (
        <div className="w-64 bg-[var(--card-bg)] shadow-md h-screen fixed flex flex-col rounded-r-md">
          <div className="p-4 text-xl font-bold text-[var(--primary)] flex items-center justify-between">
            <span>BI Dashboard</span>
            <button
              onClick={toggleTheme}
              className="p-2 rounded-md hover:bg-[var(--secondary)]/20 transition-colors"
              aria-label={theme === 'light' ? 'Switch to dark mode' : 'Switch to light mode'}
            >
              {theme === 'light' ? 'üåô' : '‚òÄÔ∏è'}
            </button>
          </div>
          <nav className="mt-4 flex-1">
            {tabs.map((tab) => (
              <button
                key={tab}
                className="w-full text-left p-4 hover:bg-[var(--secondary)]/10 rounded-md transition-colors text-[var(--text-color)] focus:outline-none focus:ring-2 focus:ring-[var(--primary)]"
                onClick={() => setActiveTab(tab)}
                aria-current={tab === activeTab ? 'page' : undefined}
              >
                {tab}
              </button>
            ))}
          </nav>
          <div className="p-4">
            <label htmlFor="category-select" className="block text-sm font-medium text-[var(--text-color)] mb-2">
              Select Category
            </label>
            <select
              id="category-select"
              value={selectedCategory}
              onChange={(e) => setSelectedCategory(e.target.value)}
              className="w-full p-2 rounded-md border border-gray-300 bg-[var(--card-bg)] text-[var(--text-color)] focus:ring-2 focus:ring-[var(--primary)]"
              aria-label="Select category for CSV upload"
            >
              {tabs.map((tab) => (
                <option key={tab} value={tab}>{tab}</option>
              ))}
            </select>
            <input
              type="file"
              accept=".csv"
              onChange={(e) => handleFileUpload(e, selectedCategory)}
              className="w-full mt-2 text-sm text-[var(--text-color)] file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:bg-[var(--primary)] file:text-white hover:file:bg-[var(--primary)]/80"
              aria-label="Upload CSV file"
            />
          </div>
        </div>
      );
    };

    const ChartComponent = ({ data, type, xKey, yKey, title, colors }) => {
      const canvasRef = useRef(null);
      useEffect(() => {
        const ctx = canvasRef.current.getContext('2d');
        const chart = new Chart(ctx, {
          type,
          data: {
            labels: data.map(item => item[xKey]),
            datasets: [{
              label: title,
              data: data.map(item => item[yKey]),
              backgroundColor: colors?.background || (type === 'bar' ? 'var(--secondary)' : 'var(--primary)'),
              borderColor: colors?.border || 'var(--primary)',
              borderWidth: 2,
            }],
          },
          options: {
            scales: { y: { beginAtZero: true } },
            responsive: true,
            maintainAspectRatio: true,
          },
        });
        return () => chart.destroy();
      }, [data, type, xKey, yKey, title, colors]);
      return <canvas ref={canvasRef} className="w-full h-64" aria-label={`${title} chart`}></canvas>;
    };

    const DataTable = ({ data, columns }) => {
      return (
        <div className="overflow-x-auto mt-6">
          <table className="min-w-full bg-[var(--card-bg)] rounded-md shadow-md">
            <thead>
              <tr className="bg-[var(--primary)] text-white">
                {columns.map((col, idx) => (
                  <th key={idx} className="p-4 text-left">{col.label}</th>
                ))}
              </tr>
            </thead>
            <tbody>
              {data.map((row, idx) => (
                <tr key={idx} className="border-t">
                  {columns.map((col, colIdx) => (
                    <td key={colIdx} className="p-4 text-[var(--text-color)]">{row[col.key]}</td>
                  ))}
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      );
    };

    const ScoreCard = ({ title, value, subtext }) => (
      <div className="bg-[var(--card-bg)] p-4 rounded-md shadow-md">
        <h3 className="text-lg font-medium text-[var(--primary)]">{title}</h3>
        <p className="text-2xl font-bold text-[var(--text-color)]">{value}</p>
        <p className="text-sm text-gray-500">{subtext}</p>
      </div>
    );

    const AccessibilityWidget = () => {
      const [isOpen, setIsOpen] = useState(false);
      const [fontSize, setFontSize] = useState(16);
      const [highContrast, setHighContrast] = useState(false);

      const adjustFontSize = (delta) => {
        const newSize = Math.max(12, Math.min(24, fontSize + delta));
        setFontSize(newSize);
        document.documentElement.style.fontSize = `${newSize}px`;
      };

      const toggleHighContrast = () => {
        setHighContrast(!highContrast);
        document.body.style.filter = highContrast ? 'none' : 'contrast(1.5)';
      };

      return (
        <div className="fixed bottom-4 right-4 accessibility-widget">
          <button
            onClick={() => setIsOpen(!isOpen)}
            className="p-3 bg-[var(--primary)] text-white rounded-full shadow-md hover:bg-[var(--primary)]/80 transition-colors"
            aria-label="Toggle accessibility options"
          >
            ‚ôø
          </button>
          {isOpen && (
            <div className="absolute bottom-12 right-0 bg-[var(--card-bg)] p-4 rounded-md shadow-md w-64">
              <h3 className="text-lg font-medium text-[var(--text-color)] mb-2">Accessibility</h3>
              <div className="flex flex-col gap-2">
                <div className="flex justify-between items-center">
                  <span className="text-[var(--text-color)]">Font Size</span>
                  <div>
                    <button onClick={() => adjustFontSize(-2)} className="p-2 rounded-md bg-[var(--secondary)]/20" aria-label="Decrease font size">-</button>
                    <span className="mx-2 text-[var(--text-color)]">{fontSize}px</span>
                    <button onClick={() => adjustFontSize(2)} className="p-2 rounded-md bg-[var(--secondary)]/20" aria-label="Increase font size">+</button>
                  </div>
                </div>
                <button
                  onClick={toggleHighContrast}
                  className="p-2 rounded-md bg-[var(--secondary)]/20 text-[var(--text-color)] hover:bg-[var(--secondary)]/30"
                  aria-label={highContrast ? 'Disable high contrast' : 'Enable high contrast'}
                >
                  {highContrast ? 'Disable High Contrast' : 'Enable High Contrast'}
                </button>
              </div>
            </div>
          )}
        </div>
      );
    };

    const TabContent = ({ activeTab, data }) => {
      const config = {
        Sales: {
          charts: [
            { type: 'line', xKey: 'month', yKey: 'value', title: 'Sales Over Time' },
            { type: 'pie', xKey: 'month', yKey: 'value', title: 'Sales Distribution', colors: { background: ['#1e40af', '#34d399', '#ff6b6b'] } },
          ],
          table: [
            { key: 'month', label: 'Month' },
            { key: 'value', label: 'Sales ($)' },
          ],
          scoreCards: [
            { title: 'Total Sales', value: `$${data.Sales.reduce((sum, item) => sum + (parseFloat(item.value) || 0), 0)}`, subtext: 'Q1 2025' },
          ],
        },
        Marketing: {
          charts: [
            { type: 'bar', xKey: 'campaign', yKey: 'leads', title: 'Marketing Leads' },
            { type: 'doughnut', xKey: 'campaign', yKey: 'leads', title: 'Leads by Campaign', colors: { background: ['#1e40af', '#34d399', '#ff6b6b'] } },
          ],
          table: [
            { key: 'campaign', label: 'Campaign' },
            { key: 'leads', label: 'Leads' },
          ],
          scoreCards: [
            { title: 'Total Leads', value: data.Marketing.reduce((sum, item) => sum + (parseInt(item.leads) || 0), 0), subtext: 'Q1 2025' },
          ],
        },
        'Customer Service': {
          charts: [
            { type: 'line', xKey: 'month', yKey: 'tickets', title: 'Support Tickets' },
            { type: 'bar', xKey: 'month', yKey: 'tickets', title: 'Tickets by Month' },
          ],
          table: [
            { key: 'month', label: 'Month' },
            { key: 'tickets', label: 'Tickets' },
          ],
          scoreCards: [
            { title: 'Total Tickets', value: data['Customer Service'].reduce((sum, item) => sum + (parseInt(item.tickets) || 0), 0), subtext: 'Q1 2025' },
          ],
        },
        Advertising: {
          charts: [
            { type: 'bar', xKey: 'platform', yKey: 'spend', title: 'Ad Spend' },
            { type: 'pie', xKey: 'platform', yKey: 'spend', title: 'Spend Distribution', colors: { background: ['#1e40af', '#34d399'] } },
          ],
          table: [
            { key: 'platform', label: 'Platform' },
            { key: 'spend', label: 'Spend ($)' },
          ],
          scoreCards: [
            { title: 'Total Spend', value: `$${data.Advertising.reduce((sum, item) => sum + (parseFloat(item.spend) || 0), 0)}`, subtext: 'Q1 2025' },
          ],
        },
        Branding: {
          charts: [
            { type: 'bar', xKey: 'channel', yKey: 'impressions', title: 'Brand Impressions' },
            { type: 'doughnut', xKey: 'channel', yKey: 'impressions', title: 'Impressions by Channel', colors: { background: ['#1e40af', '#34d399'] } },
          ],
          table: [
            { key: 'channel', label: 'Channel' },
            { key: 'impressions', label: 'Impressions' },
          ],
          scoreCards: [
            { title: 'Total Impressions', value: data.Branding.reduce((sum, item) => sum + (parseInt(item.impressions) || 0), 0), subtext: 'Q1 2025' },
          ],
        },
        OKR: {
          charts: [
            { type: 'bar', xKey: 'goal', yKey: 'progress', title: 'OKR Progress' },
            { type: 'pie', xKey: 'goal', yKey: 'progress', title: 'Goal Progress', colors: { background: ['#1e40af', '#34d399'] } },
          ],
          table: [
            { key: 'goal', label: 'Goal' },
            { key: 'progress', label: 'Progress (%)' },
          ],
          scoreCards: [
            { title: 'Average Progress', value: `${Math.round(data.OKR.reduce((sum, item) => sum + (parseFloat(item.progress) || 0), 0) / data.OKR.length)}%`, subtext: 'Q1-Q2 2025' },
          ],
        },
        Revenue: {
          charts: [
            { type: 'line', xKey: 'month', yKey: 'amount', title: 'Revenue Over Time' },
            { type: 'bar', xKey: 'month', yKey: 'amount', title: 'Revenue by Month' },
          ],
          table: [
            { key: 'month', label: 'Month' },
            { key: 'amount', label: 'Revenue ($)' },
          ],
          scoreCards: [
            { title: 'Total Revenue', value: `$${data.Revenue.reduce((sum, item) => sum + (parseFloat(item.amount) || 0), 0)}`, subtext: 'Q1 2025' },
          ],
        },
      };

      if (!config[activeTab]) {
        return (
          <div className="p-6 bg-[var(--card-bg)] rounded-md shadow-md">
            <h2 className="text-2xl font-semibold text-[var(--primary)] mb-4">Error</h2>
            <p className="text-red-600">Invalid tab selected. Please choose a valid tab.</p>
          </div>
        );
      }

      const { charts, table, scoreCards } = config[activeTab];
      return (
        <div className="p-6 bg-[var(--card-bg)] rounded-md shadow-md">
          <h2 className="text-2xl font-semibold text-[var(--primary)] mb-4">{activeTab}</h2>
          <div className="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
            {scoreCards.map((card, idx) => (
              <ScoreCard key={idx} title={card.title} value={card.value} subtext={card.subtext} />
            ))}
          </div>
          <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
            {charts.map((chart, idx) => (
              <div key={idx} className="bg-[var(--card-bg)] p-4 rounded-md shadow-md">
                <h3 className="text-lg font-medium text-[var(--primary)] mb-2">{chart.title}</h3>
                <ChartComponent
                  data={data[activeTab]}
                  type={chart.type}
                  xKey={chart.xKey}
                  yKey={chart.yKey}
                  title={chart.title}
                  colors={chart.colors}
                />
              </div>
            ))}
          </div>
          <h3 className="text-lg font-medium text-[var(--primary)] mb-2">Data Table</h3>
          <DataTable data={data[activeTab]} columns={table} />
        </div>
      );
    };

    const App = () => {
      const [activeTab, setActiveTab] = useState(localStorage.getItem('activeTab') || 'Sales');
      const [theme, setTheme] = useState(localStorage.getItem('theme') || 'light');
      const [data, setData] = useState(() => {
        const savedData = localStorage.getItem('dashboardData');
        return savedData ? JSON.parse(savedData) : initialData;
      });

      useEffect(() => {
        localStorage.setItem('activeTab', activeTab);
        localStorage.setItem('theme', theme);
        localStorage.setItem('dashboardData', JSON.stringify(data));
        document.body.setAttribute('data-theme', theme);
      }, [activeTab, theme, data]);

      const toggleTheme = () => {
        setTheme(theme === 'light' ? 'dark' : 'light');
      };

      const handleFileUpload = (event, category) => {
        const file = event.target.files[0];
        if (file && file.type === 'text/csv') {
          const reader = new FileReader();
          reader.onload = (e) => {
            const text = e.target.result;
            const rows = text.split('\n').map(row => row.split(','));
            const headers = rows[0].map(h => h.trim());
            const expectedHeaders = headerConfig[category];

            if (!headers.every((h, i) => h === expectedHeaders[i])) {
              alert(`Invalid CSV headers for ${category}. Expected: ${expectedHeaders.join(', ')}`);
              return;
            }

            const newData = rows.slice(1).filter(row => row.length === headers.length).map(row => {
              const obj = {};
              headers.forEach((header, idx) => {
                obj[header] = row[idx]?.trim();
              });
              return obj;
            });

            setData(prev => ({
              ...prev,
              [category]: newData,
            }));
            setActiveTab(category);
            alert(`Data for ${category} imported successfully!`);
          };
          reader.readAsText(file);
        } else {
          alert('Please upload a valid CSV file.');
        }
      };

      return (
        <div className="flex min-h-screen bg-[var(--bg-color)]">
          <Sidebar
            setActiveTab={setActiveTab}
            theme={theme}
            toggleTheme={toggleTheme}
            activeTab={activeTab}
            handleFileUpload={handleFileUpload}
          />
          <div className="ml-64 p-6 w-full">
            <TabContent activeTab={activeTab} data={data} />
          </div>
          <AccessibilityWidget />
        </div>
      );
    };

    const root = createRoot(document.getElementById('root'));
    root.render(<App />);
  </script>
</body>
</html>
